<div class="col-xs-6">
  <h1>
    <% if @world.project.eql? @world.component %>
      <%= @world.project -%>
    <% else %>
      <%= @world.project + ": " + @world.component -%>
    <% end %>
  </h1>
  <h2><%= @world.version -%></h2>
</div>

<div class="col-xs-6">
  <table class="table">

    <tr><th>ID</th><td><%= @world.id -%></td></tr>
    <tr><th>Component</th><td><%= @world.component -%></td></tr>
    <tr><th>Version</th><td><%= @world.version -%></td></tr>
    <tr><th>Runs</th><td><%= @world.runs.count -%></td></tr>
  </table>
</div>

<div class="col-xs-12">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs">
    <li class="active"><a href="#runs" data-toggle="tab">Runs</a></li>
    <li><a href="#results" data-toggle="tab">Results</a></li>
    <li><a href="#compare" data-toggle="tab">Compare</a></li>

  </ul>


  <!-- Tab panes -->
  <div class="tab-content">
    <div class="tab-pane " id="runs">

    <br />

  <table class="table table-striped table-condensed">

    <thead>
    <tr>
      <th>Run ID</th>
      <th>Target</th>
      <th>Status</th>
      <th>Started</th>
      <th>Duration</th>
    </tr>

    </thead>

  <% @runs.each do |r| %>

    <tr>
      <td><%= link_to r.id, "/runs/#{r.id}" -%></td>
      <td><%= r.target -%></td>
      <td><%= status_badge(r.status) -%>
          <%= hive_job_link(r) -%>
      </td>
      <td><%= r.started_at.to_s(:short) -%></td>
      <td><%= r.duration -%></td>
    </tr>

  <% end %>
  </table>

  </div>

  <div class="tab-pane active" id="results">

  <br />

  <table class="table table-condensed">

    <tr>
      <th colspan="2">Test</th>
      <th>Target</th>
      <th></th>
      <th>Result</th>
      <th>
        <span class="badge-pass badge-result">P</span>
        <span class="badge badge-fail badge-result">F</span>
        <span class="badge badge-notrun badge-result">N</span>
        <span class="badge badge-error badge-result">E</span>
      </th>
    </tr>

    <% @aggregate_results.each do |r| %>
    
        <% id="aggregate-#{r.world.id.to_s}-#{r.test_definition.id.to_s}-#{r.target}" %>
      
        <tr id="<%=id-%>" class="info aggregate-loader">
          <td colspan="2">
            <strong>
              <%=  pretty_truncate("#{h r.test_definition.name} <code>#{r.test_definition.file_name(:short)}</code>", 80, 'strong') -%>
            </strong>
          </td>
          <td><%= r.target -%></td>

          <td><%= r.results.count %></td>
          <td>
            <span class="result">????</span>
          </td>
          <td>
            <span class="badge badge-result badge-pass">?</span>
            <span class="badge badge-result badge-fail">?</span>
            <span class="badge badge-result badge-notrun">?</span>
            <span class="badge badge-result badge-error">?</span>
          </td>
        </tr>
          
    <% end %>


  </table>
</div>

<div class="tab-pane" id="compare">

      <br />

      <p>Compare results against...</p>
      <ul>

      <% if @comparison_worlds.empty? %>

        <p>Couldn't find any comparison worlds</p>

      <% end %>

      <% @comparison_worlds.each do |w| %>

        <li><%= link_to w.version, "/worlds/#{@world.id}/#{w.id}" -%></li>

      <% end %>
      </ul>



    </div>

</div>


<script>
  loadAggregates()
</script>
